## SQL JOIN 및 집합 연산자


### 1\. JOIN

`JOIN`은 두 개 이상의 테이블을 연결하여 관련된 데이터를 한번에 조회하는 방법입니다.

#### 1.1. CROSS JOIN (카티션 곱)

`CROSS JOIN`은 조인되는 테이블의 각 행들이 다른 테이블의 모든 행과 조인되어, 두 테이블의 행의 개수를 곱한 만큼의 결과를 반환합니다.

  - **용도**: 보통 테스트를 위한 대용량 데이터를 생성할 때 사용되며, `WHERE` 절에 조인 조건을 명시하지 않으면 이와 동일한 결과가 나옵니다.
  - **SQL 코드**:
    ```sql
    -- EMPLOYEES 테이블과 DEPARTMENTS 테이블의 모든 행의 조합을 반환
    SELECT *
    FROM EMPLOYEES
             CROSS JOIN DEPARTMENTS
    ;
    ```

-----

#### 1.2. NATURAL JOIN

`NATURAL JOIN`은 두 테이블에서 **이름이 같은 컬럼**을 기준으로 자동으로 조인을 수행합니다.

  - **특징**:
      - 이름이 같은 컬럼을 자동으로 찾아 조인하므로 `ON` 이나 `USING` 절을 사용하지 않습니다.
      - 조인 기준이 되는 공통 컬럼은 **별칭(Alias)을 붙일 수 없습니다.**
  - **SQL 코드**:
    ```sql
    -- USERS(U)와 USER_PROFILES(UP) 테이블에서 공통 컬럼인 USER_ID를 기준으로 자동 조인
    -- NATURAL JOIN을 사용할 때는 공통 컬럼(USER_ID)에 별칭(U.USER_ID)을 사용할 수 없다.
    SELECT USER_ID,
           U.USERNAME,
           U.EMAIL,
           UP.FULL_NAME,
           UP.BIO
    FROM USERS U
    NATURAL JOIN USER_PROFILES UP
    ;
    ```

-----

#### 1.3. INNER JOIN (ON 사용)

`INNER JOIN`은 가장 일반적인 조인 방식으로, `ON` 절에 명시된 조인 조건을 만족하는 행들만 반환합니다.

  - **특징**: `NATURAL JOIN`과 달리 조인할 컬럼을 `ON` 절에 명시적으로 지정할 수 있어 더 명확하고 안전합니다.
  - **SQL 코드**:
    ```sql
    -- ON 절에 U.USER_ID = UP.USER_ID 라는 명시적인 조인 조건을 사용
    SELECT *
    FROM USERS U
    INNER JOIN USER_PROFILES UP
    ON U.USER_ID = UP.USER_ID
    ;
    ```

-----

#### 1.4. JOIN (USING 절 사용)

두 테이블 간에 조인하려는 컬럼의 **이름이 동일**할 경우 `USING` 절을 사용하여 코드를 간결하게 만들 수 있습니다.

  - **특징**:
      - `ON U.USER_ID = UP.USER_ID`와 동일한 역할을 합니다.
      - `USING` 절에 사용된 컬럼은 **별칭(Alias)을 붙일 수 없습니다.**
  - **SQL 코드**:
    ```sql
    -- USING(USER_ID)는 ON U.USER_ID = UP.USER_ID와 동일하게 동작
    -- USING 절에 명시된 USER_ID는 별칭 없이 사용해야 한다.
    SELECT USER_ID,
           U.USERNAME,
           U.EMAIL,
           UP.FULL_NAME,
           UP.BIO
    FROM USERS U
    JOIN USER_PROFILES UP
    USING (USER_ID)
    ;
    ```

| 조인 키워드      | 특징                                                                         | 사용 예시                               |
| ---------------- | ---------------------------------------------------------------------------- | --------------------------------------- |
| **NATURAL JOIN** | 이름이 같은 모든 컬럼을 기준으로 자동 조인. 공통 컬럼에 별칭 사용 불가.      | `... FROM T1 NATURAL JOIN T2`           |
| **USING** | 이름이 같은 특정 컬럼을 지정하여 조인. `ON` 절의 단축 표현. 공통 컬럼에 별칭 사용 불가. | `... FROM T1 JOIN T2 USING (col_name)`  |
| **ON** | 조인 조건을 명시적으로 지정. 가장 일반적이고 명확한 방법.                     | `... FROM T1 JOIN T2 ON T1.c1 = T2.c2`  |

-----

#### 1.5. SELF JOIN (자체 조인)

`SELF JOIN`은 하나의 테이블을 자기 자신과 조인하는 기법입니다. 보통 계층적인 구조를 가진 데이터를 다룰 때 사용됩니다.

  - **용도**: 하나의 테이블 내에서 특정 컬럼과 다른 컬럼이 관계를 맺고 있을 때 사용합니다. (예: 사원 테이블의 사원 ID와 관리자 ID)
  - **특징**:
      - 하나의 테이블을 두 개의 다른 테이블인 것처럼 별칭(Alias)을 부여하여 사용해야 합니다.
      - 한쪽의 조건이 없을 수도 있는 경우(예: 관리자가 없는 최상위 사원)를 고려하여 `OUTER JOIN`을 사용하는 것이 일반적입니다.
  - **SQL 코드**:
    ```sql
    -- 한 테이블(USERS)을 U1(사원), U2(상사)로 나누어 조인
    -- 모든 사원을 표시하기 위해 LEFT JOIN 사용
    -- NVL 함수를 통해 상사가 없는 경우(MANAGER_ID가 NULL) '상사없음'으로 표시
    SELECT
        U1.USER_ID,
        U1.USERNAME,
        U1.MANAGER_ID,
        NVL(U2.USERNAME, '상사없음') AS MANAGER_NAME
    FROM USERS U1
    LEFT JOIN USERS U2
    ON U1.MANAGER_ID = U2.USER_ID -- 사원의 매니저ID와 상사의 사원ID를 조인
    ORDER BY U1.USER_ID
    ;
    ```
